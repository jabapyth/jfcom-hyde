<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Jared | Forsyth
    </title>    <link rel="stylesheet" href="/media/bootstrap/css/bootstrap.css"/>
    <link rel="stylesheet" href="/media/css/general.css"/>
<link rel="stylesheet" href="/media/css/header.css"/>
<link rel="stylesheet" href="/media/css/blog-post.css"/>
  </head>
  <body class=""><div id="header" class="clearfix">
  <div class="title">Jared Forsyth
  </div>
  <div class="nav-internal"><nav class=nav nav-pills>
    <ul class="nav nav-pills">
                <li>
            <a title="Home Page"
                class="button white home"
                                                href="/index.html"
                                >
                home
            </a>
        </li>        <li>
            <a title="Projects"
                class="button white projects"
                                                href="/projects"
                                >
                projects
            </a>
        </li>        <li>
            <a title="Blog"
                class="button white blog"
                                                href="/blog"
                                >
                blog
            </a>
        </li>        <li>
            <a title="About"
                class="button white about"
                                                href="/about.html"
                                >
                about
            </a>
        </li>    </ul>
</nav>
  </div>
  <div class="nav-external"><nav class=nav nav-pills>
    <ul class="nav nav-pills">
                <li>
            <a title="my github repositories"
                class="button white github"
                                target="_blank"
                                                href="/http%3A//github.com/jabapyth"
                                >
                github
            </a>
        </li>        <li>
            <a title="my twitter account"
                class="button white twitter"
                                target="_blank"
                                                href="/http%3A//twitter.com/jabapyth"
                                >
                twitter
            </a>
        </li>        <li>
            <a title="my linkedin profile"
                class="button white linkedin"
                                target="_blank"
                                                href="/http%3A//www.linkedin.com/profile/view%3Fid%3D37203333"
                                >
                linkedin
            </a>
        </li>        <li>
            <a title="my stackoverflow profile"
                class="button white stackoverflow"
                                target="_blank"
                                                href="/http%3A//stackoverflow.com/users/290784/jared-forsyth"
                                >
                stackoverflow
            </a>
        </li>    </ul>
</nav>
  </div>
</div><div id="content">
<article class="post">
<nav class="post_nav">
<a class="backlink" href="/blog/2010/may/25">Back to list</a>
<a class="prev"
    title="Just wasted an hour; thanks, Rhino"
        href="/blog/2010/may/26/just-wasted-hour-thanks-rhino.html">
    Previous
</a>

<a class="next"
    title="Python operator magic"
        href="/blog/2010/may/21/python-operator-magic.html">
    Next
</a>

</nav>
<h1 class="title">
    <a href="/blog/2010/may/25/python-deepsort.html">
        Python Deepsort
    </a>
</h1>
<time datetime="2010-05-25">
    Posted: Tue, 25 May 2010
</time>


<div class="document">
<p>There are times when you want a sequence of items sorted, but regular
<tt class="docutils literal">sort()</tt> doesn&#8217;t cut it; in normal sorting algorithms, it is assumed that if
<tt class="docutils literal">cmp(a, b) == 0</tt> and <tt class="docutils literal">cmp(b, c) == 0</tt>, then <tt class="docutils literal">cmp(a, c) == 0</tt>. I ran into
a problem here when trying to sort classes by inheritance; sort order is not
necessarily&nbsp;commutative.</p>
<p>I needed to sort a list of classes (the Standard Exceptions) such that they
were declared in the right order; a class must be declared after all of its
base&nbsp;classes.</p>
<p>Consider the&nbsp;following:</p>
<pre class="code python literal-block">
<span class="keyword">class</span> <span class="name class">A</span><span class="punctuation">:</span><span class="keyword">pass</span>
<span class="keyword">class</span> <span class="name class">C</span><span class="punctuation">:</span><span class="keyword">pass</span>
<span class="keyword">class</span> <span class="name class">D</span><span class="punctuation">:</span><span class="keyword">pass</span>
<span class="keyword">class</span> <span class="name class">B</span><span class="punctuation">(</span><span class="name">A</span><span class="punctuation">):</span><span class="keyword">pass</span>
</pre>
<p>Clearly, A should come before B, but the relative orders of A, C, and D
doesn&#8217;t really matter. The reason <tt class="docutils literal">sort()</tt> won&#8217;t work here is <tt class="docutils literal">cmp(A, C) ==
0</tt> and <tt class="docutils literal">cmp(C, B) == 0</tt> but <tt class="docutils literal">cmp(A, B) != 0</tt>. (I tried doing a sort and
was at first confused by the apparently random results I was&nbsp;getting.)</p>
<p>Here&#8217;s the code I came up&nbsp;with:</p>
<pre class="code python literal-block">
<span class="keyword">def</span> <span class="name function">deepsort</span><span class="punctuation">(</span><span class="name">lst</span><span class="punctuation">,</span> <span class="name builtin">cmp</span><span class="operator">=</span><span class="name builtin">cmp</span><span class="punctuation">,</span> <span class="name builtin">max</span><span class="operator">=</span><span class="literal number integer">1000</span><span class="punctuation">):</span>
    <span class="keyword">for</span> <span class="name">counter</span> <span class="operator word">in</span> <span class="name builtin">xrange</span><span class="punctuation">(</span><span class="name builtin">max</span><span class="punctuation">):</span>
        <span class="keyword">for</span> <span class="name">x</span> <span class="operator word">in</span> <span class="name builtin">range</span><span class="punctuation">(</span><span class="name builtin">len</span><span class="punctuation">(</span><span class="name">lst</span><span class="punctuation">)):</span>
            <span class="keyword">for</span> <span class="name">y</span> <span class="operator word">in</span> <span class="name builtin">range</span><span class="punctuation">(</span><span class="name">x</span><span class="operator">+</span><span class="literal number integer">1</span><span class="punctuation">,</span> <span class="name builtin">len</span><span class="punctuation">(</span><span class="name">lst</span><span class="punctuation">)):</span>
                <span class="name">res</span> <span class="operator">=</span> <span class="name builtin">cmp</span><span class="punctuation">(</span><span class="name">lst</span><span class="punctuation">[</span><span class="name">x</span><span class="punctuation">],</span> <span class="name">lst</span><span class="punctuation">[</span><span class="name">y</span><span class="punctuation">])</span>
                <span class="keyword">if</span> <span class="name">res</span> <span class="operator">==</span> <span class="literal number integer">1</span><span class="punctuation">:</span>
                    <span class="name">lst</span><span class="punctuation">[</span><span class="name">x</span><span class="punctuation">],</span> <span class="name">lst</span><span class="punctuation">[</span><span class="name">y</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">lst</span><span class="punctuation">[</span><span class="name">y</span><span class="punctuation">],</span> <span class="name">lst</span><span class="punctuation">[</span><span class="name">x</span><span class="punctuation">]</span>
                    <span class="keyword">break</span>
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="keyword">continue</span>
            <span class="keyword">break</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            <span class="keyword">break</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="keyword">raise</span> <span class="name exception">Exception</span><span class="punctuation">(</span><span class="literal string">'couldn</span><span class="literal string escape">\'</span><span class="literal string">t resolve after </span><span class="literal string interpol">%d</span><span class="literal string"> iterations. possible circular comparisons.'</span> <span class="operator">%</span> <span class="name builtin">max</span><span class="punctuation">)</span>
</pre>
<p>Now, I can&#8217;t claim that it&#8217;s all that fast or efficient, but as this was a
one-off operation, I didn&#8217;t much&nbsp;care.</p>
<p>Essentially, it&#8217;s a least-fixed-point algorithm, going down the list,
comparing two items, and switching them if one should come before the other. I
put in a max iterations vbl because it&#8217;s possible for such a sorting to be
cyclic, and therefor never resolvable (not with python classes+bases, but with
other <tt class="docutils literal">cmp</tt> methods).</p>
<p>For those who are interested, this is the <tt class="docutils literal">cmp</tt> function I&nbsp;used.</p>
<pre class="code python literal-block">
<span class="keyword">def</span> <span class="name function">classcmp</span><span class="punctuation">(</span><span class="name">a</span><span class="punctuation">,</span> <span class="name">b</span><span class="punctuation">):</span>
    <span class="keyword">if</span> <span class="name builtin">issubclass</span><span class="punctuation">(</span><span class="name">a</span><span class="punctuation">,</span><span class="name">b</span><span class="punctuation">)</span> <span class="operator word">and</span> <span class="operator word">not</span> <span class="name builtin">issubclass</span><span class="punctuation">(</span><span class="name">b</span><span class="punctuation">,</span><span class="name">a</span><span class="punctuation">):</span>
        <span class="keyword">return</span> <span class="literal number integer">1</span>
    <span class="keyword">if</span> <span class="name builtin">issubclass</span><span class="punctuation">(</span><span class="name">b</span><span class="punctuation">,</span><span class="name">a</span><span class="punctuation">)</span> <span class="operator word">and</span> <span class="operator word">not</span> <span class="name builtin">issubclass</span><span class="punctuation">(</span><span class="name">a</span><span class="punctuation">,</span><span class="name">b</span><span class="punctuation">):</span>
        <span class="keyword">return</span> <span class="operator">-</span><span class="literal number integer">1</span>
    <span class="keyword">return</span> <span class="literal number integer">0</span>
</pre>
<p>Have you run into this before? Is there a std lib function I was stupidly
ignoring? <a class="reference external" href="http://jaredforsyth.com/blog/2010/may/25/python-deepsort/#comments">Tell me in the comments</a>.</p>
</div>

</article>

<div class="post-comments">
    <a name="comments"></a>
    <script>
        var disqus_identifier = "python-deepsort";
    </script>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
    /**
    * var disqus_identifier; [Optional but recommended: Define a unique
    * identifier (e.g. post id or slug) for this thread] 
    */
    (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://jaredforsyth.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=jaredforsyth">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

</div>
</div>  </body>
</html>